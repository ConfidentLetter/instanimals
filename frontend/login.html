<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Instanimals</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <nav class="nav">
      <div class="container nav-inner">
        <a class="home-badge" href="/">
          <div class="home-icon">
            <img class="logo-ico" src="/assets/success/house-badge.png" alt="logo" />
          </div>
          <div class="home-text">Home</div>
        </a>
        <div class="nav-links">
          <a href="/#stories">Success Stories</a>
          <a href="/#how">How it Works</a>
          <a href="/login.html">Login</a>
          <div class="user-pill">ðŸ‘¤</div>
        </div>
      </div>
    </nav>

    <main class="login-wrap">
      <div class="container">
        <h1 class="center-title">Login:</h1>
        <div class="center-sub">Thank you for being a foster family</div>

        <div class="form-card login-card">
          <form id="authForm">
            <div class="row2">
              <div class="field">
                <label>Email</label>
                <input id="email" type="email" placeholder="you@email.com" />
              </div>
              <div class="field">
                <label>Password</label>
                <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
              </div>
            </div>

            <div style="text-align:center; margin-top:16px;">
              <button class="btn" id="loginBtn" type="button">Login</button>
              <button class="btn secondary" id="registerBtn" type="button" style="margin-left:10px;">Register</button>
              <button class="btn secondary" id="logoutBtn" type="button" style="display:none;margin-left:10px;">Logout</button>
            </div>

            <div class="notice" id="authStatus" style="margin-top:14px;">
              Not logged in.
            </div>

            <div class="small" style="margin-top:10px;">
              Tip: Register creates a Firebase Auth account (email/password).
            </div>
          </form>
        </div>
      </div>
    </main>

    <script type="module">
      // âœ… Fill from Firebase Console -> Project settings -> General -> Your apps (Web app) -> Config
      const firebaseConfig = {
        apiKey: "PASTE_ME",
        authDomain: "PASTE_ME",
        projectId: "instanimals-8f702",
        appId: "PASTE_ME",
      };

      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        createUserWithEmailAndPassword,
        signOut,
        onAuthStateChanged
      } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      const $ = (id) => document.getElementById(id);
      const statusEl = $("authStatus");
      const loginBtn = $("loginBtn");
      const registerBtn = $("registerBtn");
      const logoutBtn = $("logoutBtn");

      function setStatus(msg){ statusEl.textContent = msg; }
      function setBusy(isBusy){
        loginBtn.disabled = isBusy;
        registerBtn.disabled = isBusy;
        loginBtn.textContent = isBusy ? "Working..." : "Login";
        registerBtn.textContent = isBusy ? "Working..." : "Register";
      }

      async function saveTokenAndGoHome(user){
        const token = await user.getIdToken();
        localStorage.setItem("idToken", token);
        localStorage.setItem("userEmail", user.email || "");
        location.href = "/";
      }

      loginBtn.addEventListener("click", async () => {
        const email = $("email").value.trim();
        const password = $("password").value;
        if(!email || !password) return setStatus("Please enter email and password.");

        setBusy(true);
        try{
          const cred = await signInWithEmailAndPassword(auth, email, password);
          setStatus(`Logged in as ${cred.user.email}`);
          await saveTokenAndGoHome(cred.user);
        }catch(err){
          console.error(err);
          setStatus("Login failed: " + (err?.message || err));
        }finally{
          setBusy(false);
        }
      });

      registerBtn.addEventListener("click", async () => {
        const email = $("email").value.trim();
        const password = $("password").value;
        if(!email || !password) return setStatus("Please enter email and password.");
        if(password.length < 6) return setStatus("Password must be at least 6 characters.");

        setBusy(true);
        try{
          const cred = await createUserWithEmailAndPassword(auth, email, password);
          setStatus(`Registered & logged in as ${cred.user.email}`);
          await saveTokenAndGoHome(cred.user);
        }catch(err){
          console.error(err);
          setStatus("Register failed: " + (err?.message || err));
        }finally{
          setBusy(false);
        }
      });

      logoutBtn.addEventListener("click", async () => {
        await signOut(auth);
        localStorage.removeItem("idToken");
        localStorage.removeItem("userEmail");
        setStatus("Logged out.");
        logoutBtn.style.display = "none";
      });

      onAuthStateChanged(auth, async (user) => {
        if(user){
          const token = await user.getIdToken();
          localStorage.setItem("idToken", token);
          localStorage.setItem("userEmail", user.email || "");
          setStatus(`Logged in as ${user.email || "user"}`);
          logoutBtn.style.display = "inline-flex";
        }else{
          setStatus("Not logged in.");
          logoutBtn.style.display = "none";
        }
      });
    </script>
  </body>
</html>